#include "unity.h"
#include "spake2plus.h"
#include "spake2plus_test.h"
#include "test_globals.h"
#include <string.h>
#include <stdbool.h>
#include <openssl/evp.h>

static char *g_pw_ptr = "test password";
static char *g_srv_id_ptr = "server";
static char *g_client_id_ptr = "client";
static char *g_aad_ptr = "";
static char *g_empty_string = "";
static size_t g_pA_or_pB_len = 0;
static uint8_t *g_pA_or_pB = NULL;
static size_t g_pA_or_pB_client_len = 0;
static uint8_t *g_pA_or_pB_client = NULL;
static size_t g_Fa_or_Fb_len = 0;
static uint8_t g_Fa_or_Fb[EVP_MAX_MD_SIZE] = {0};
static size_t g_Fa_or_Fb_client_len = 0;
static uint8_t g_Fa_or_Fb_client[EVP_MAX_MD_SIZE] = {0};
static size_t g_mac_a_len = 0;
static uint8_t g_mac_a[EVP_MAX_MD_SIZE] = {0};
//static size_t g_mac_b_len = 0;
//static uint8_t g_mac_b[EVP_MAX_MD_SIZE] = {0};

static SPAKE2PLUS *spake2_client_inst = NULL;

static BN_CTX *g_ctx = NULL;
static EC_POINT *g_test_vector_Z = NULL;
static EC_POINT *g_test_vector_V = NULL;
static EC_POINT *g_Z = NULL;
static EC_POINT *g_V = NULL;
static BIGNUM *g_x = NULL;
static BIGNUM *g_y = NULL;
static uint8_t *g_TT = NULL;
static size_t g_TT_len = 0;
static uint8_t g_md_value[EVP_MAX_MD_SIZE];
static size_t g_md_len = EVP_MAX_MD_SIZE;

static uint8_t g_test_vector_cs_w0[] =
    {
        0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64, 0xf9, 0xdc, 0x7a, 0x01,
        0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab, 0xc4, 0xf9, 0xed, 0x56,
        0x88, 0x05, 0xca, 0x84, 0xf4, 0xed, 0x3e, 0xf8, 0x06, 0x51,
        0x6c, 0xf8};
static uint8_t g_test_vector_cs_w1[] =
    {
        0x8d, 0x73, 0xe4, 0xca, 0x27, 0x38, 0x59, 0xc8, 0x73, 0xd8,
        0x09, 0x43, 0x1d, 0x15, 0xf3, 0x0e, 0x2b, 0x72, 0x20, 0x07,
        0x96, 0x4e, 0x32, 0x69, 0x91, 0x60, 0xb5, 0x4f, 0xda, 0x3e,
        0xe8, 0x55};
static uint8_t g_test_vector_cs_L[] =
    {
        0x04, 0x91, 0xbb, 0x1e, 0x66, 0x72, 0xe7, 0x1a, 0xd8, 0x0b,
        0x17, 0xd1, 0x3f, 0x7a, 0x72, 0xca, 0x2f, 0xe7, 0xf8, 0x82,
        0xd4, 0xbd, 0x73, 0x4e, 0x2d, 0x14, 0x0f, 0x67, 0xab, 0x49,
        0xd2, 0xc3, 0xe7, 0x6d, 0xbc, 0xf7, 0x06, 0x95, 0x4b, 0xd9,
        0xad, 0xa4, 0xe3, 0xa7, 0xfc, 0x50, 0xcf, 0x92, 0x94, 0x72,
        0x9f, 0x93, 0xb1, 0x30, 0xad, 0xa3, 0xd3, 0xa4, 0xae, 0x98,
        0xcc, 0x7e, 0x7b, 0x69, 0x71};
static uint8_t g_test_vector_cs_X[] =
    {
        0x04, 0x87, 0x95, 0x67, 0xd0, 0x95, 0x60, 0xc0, 0x2b, 0xe5,
        0x65, 0x42, 0x90, 0x36, 0xed, 0x1d, 0x2f, 0xc3, 0xca, 0x53,
        0xf2, 0xeb, 0x6f, 0xad, 0xda, 0x4d, 0xba, 0x09, 0xef, 0xf3,
        0xa0, 0x09, 0x6f, 0x03, 0x2f, 0x0e, 0x22, 0x72, 0x07, 0xeb,
        0xeb, 0xe0, 0x5e, 0x1e, 0x95, 0xde, 0x32, 0x5d, 0xff, 0xfe,
        0x57, 0x9c, 0x8a, 0xae, 0x76, 0x05, 0x40, 0x30, 0xe5, 0x43,
        0x5f, 0xd5, 0x29, 0x8c, 0x75};
static uint8_t g_test_vector_cs_Y[] =
    {
        0x04, 0xb5, 0x95, 0xa2, 0x55, 0x88, 0xa2, 0xfb, 0xa7, 0x57,
        0x19, 0x5a, 0x75, 0x6d, 0x28, 0x9c, 0x19, 0x12, 0x40, 0x29,
        0x66, 0x99, 0xf6, 0x1f, 0xee, 0x8f, 0x15, 0xa7, 0xa7, 0x41,
        0xa4, 0x23, 0xd4, 0x8b, 0xd4, 0x4c, 0xf5, 0x44, 0xb4, 0x09,
        0xbb, 0xe4, 0x26, 0x2a, 0x80, 0x45, 0x05, 0x1e, 0x73, 0x45,
        0x67, 0x54, 0x8b, 0xa4, 0x3b, 0x31, 0x17, 0xef, 0xd6, 0xfb,
        0x03, 0xac, 0xf4, 0x1a, 0xff};
static uint8_t g_test_vector_cs_Z[] =
    {
        0x04, 0x7b, 0xb4, 0x66, 0x1d, 0xb7, 0x08, 0x5d, 0x01, 0x9c,
        0xff, 0xa8, 0x49, 0x5a, 0xba, 0x73, 0xd2, 0x2f, 0x87, 0xab,
        0x8b, 0xa2, 0x2e, 0x78, 0x94, 0x77, 0xef, 0x93, 0x3b, 0x91,
        0x6f, 0x41, 0x28, 0x63, 0xae, 0xb2, 0xdb, 0xc8, 0x00, 0x3e,
        0x4f, 0x1c, 0x21, 0x93, 0x29, 0x03, 0x38, 0xea, 0x0c, 0x7d,
        0x78, 0x6d, 0x30, 0xca, 0x47, 0xa4, 0x8e, 0xea, 0x27, 0x33,
        0x75, 0xa0, 0xc7, 0x2c, 0xa1};
static uint8_t g_test_vector_cs_V[] =
    {
        0x04, 0x17, 0x65, 0x8e, 0x1e, 0x97, 0x07, 0xa2, 0x9d, 0x42,
        0x9a, 0x47, 0x33, 0xd3, 0xbe, 0xe7, 0x03, 0x57, 0x4a, 0xec,
        0x22, 0x2e, 0x78, 0x1a, 0x6e, 0x7e, 0x5f, 0x5e, 0x50, 0x49,
        0x08, 0x11, 0xaa, 0xbf, 0x28, 0xe1, 0x12, 0xfe, 0xe3, 0x2a,
        0x37, 0xc2, 0x28, 0xdf, 0x9b, 0x53, 0xe6, 0x22, 0x04, 0x68,
        0xa2, 0xf6, 0xf0, 0x74, 0x27, 0x60, 0x4d, 0x89, 0x17, 0x87,
        0x0a, 0xc9, 0x65, 0xee, 0xc7};
static uint8_t g_test_vector_cs_TT[] =
    {
        0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x63, 0x6c,
        0x69, 0x65, 0x6e, 0x74, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x73, 0x65, 0x72, 0x76, 0x65, 0x72, 0x41, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x87, 0x95, 0x67,
        0xd0, 0x95, 0x60, 0xc0, 0x2b, 0xe5, 0x65, 0x42, 0x90, 0x36,
        0xed, 0x1d, 0x2f, 0xc3, 0xca, 0x53, 0xf2, 0xeb, 0x6f, 0xad,
        0xda, 0x4d, 0xba, 0x09, 0xef, 0xf3, 0xa0, 0x09, 0x6f, 0x03,
        0x2f, 0x0e, 0x22, 0x72, 0x07, 0xeb, 0xeb, 0xe0, 0x5e, 0x1e,
        0x95, 0xde, 0x32, 0x5d, 0xff, 0xfe, 0x57, 0x9c, 0x8a, 0xae,
        0x76, 0x05, 0x40, 0x30, 0xe5, 0x43, 0x5f, 0xd5, 0x29, 0x8c,
        0x75, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
        0xb5, 0x95, 0xa2, 0x55, 0x88, 0xa2, 0xfb, 0xa7, 0x57, 0x19,
        0x5a, 0x75, 0x6d, 0x28, 0x9c, 0x19, 0x12, 0x40, 0x29, 0x66,
        0x99, 0xf6, 0x1f, 0xee, 0x8f, 0x15, 0xa7, 0xa7, 0x41, 0xa4,
        0x23, 0xd4, 0x8b, 0xd4, 0x4c, 0xf5, 0x44, 0xb4, 0x09, 0xbb,
        0xe4, 0x26, 0x2a, 0x80, 0x45, 0x05, 0x1e, 0x73, 0x45, 0x67,
        0x54, 0x8b, 0xa4, 0x3b, 0x31, 0x17, 0xef, 0xd6, 0xfb, 0x03,
        0xac, 0xf4, 0x1a, 0xff, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x04, 0x7b, 0xb4, 0x66, 0x1d, 0xb7, 0x08, 0x5d,
        0x01, 0x9c, 0xff, 0xa8, 0x49, 0x5a, 0xba, 0x73, 0xd2, 0x2f,
        0x87, 0xab, 0x8b, 0xa2, 0x2e, 0x78, 0x94, 0x77, 0xef, 0x93,
        0x3b, 0x91, 0x6f, 0x41, 0x28, 0x63, 0xae, 0xb2, 0xdb, 0xc8,
        0x00, 0x3e, 0x4f, 0x1c, 0x21, 0x93, 0x29, 0x03, 0x38, 0xea,
        0x0c, 0x7d, 0x78, 0x6d, 0x30, 0xca, 0x47, 0xa4, 0x8e, 0xea,
        0x27, 0x33, 0x75, 0xa0, 0xc7, 0x2c, 0xa1, 0x41, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x17, 0x65, 0x8e, 0x1e,
        0x97, 0x07, 0xa2, 0x9d, 0x42, 0x9a, 0x47, 0x33, 0xd3, 0xbe,
        0xe7, 0x03, 0x57, 0x4a, 0xec, 0x22, 0x2e, 0x78, 0x1a, 0x6e,
        0x7e, 0x5f, 0x5e, 0x50, 0x49, 0x08, 0x11, 0xaa, 0xbf, 0x28,
        0xe1, 0x12, 0xfe, 0xe3, 0x2a, 0x37, 0xc2, 0x28, 0xdf, 0x9b,
        0x53, 0xe6, 0x22, 0x04, 0x68, 0xa2, 0xf6, 0xf0, 0x74, 0x27,
        0x60, 0x4d, 0x89, 0x17, 0x87, 0x0a, 0xc9, 0x65, 0xee, 0xc7,
        0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4f, 0x9e,
        0x28, 0x32, 0x2a, 0x64, 0xf9, 0xdc, 0x7a, 0x01, 0xb2, 0x82,
        0xcc, 0x51, 0xe2, 0xab, 0xc4, 0xf9, 0xed, 0x56, 0x88, 0x05,
        0xca, 0x84, 0xf4, 0xed, 0x3e, 0xf8, 0x06, 0x51, 0x6c, 0xf8};
static uint8_t g_test_vector_cs_Ka[] =
    {
        0xbf, 0x80, 0x00, 0x62, 0x84, 0x7c, 0x51, 0x82, 0xbf, 0x5c,
        0x54, 0x9b, 0x05, 0xea, 0x6c, 0xce};
static uint8_t g_test_vector_cs_Ke[] =
    {
        0xce, 0x9a, 0xcf, 0x88, 0xff, 0x94, 0x40, 0x77, 0x7b, 0xda,
        0x3e, 0x34, 0xfa, 0x49, 0x93, 0xcd};
static uint8_t g_test_vector_cs_KcA[] =
    {
        0x73, 0xc6, 0xa5, 0x59, 0x70, 0x96, 0xe9, 0x9b, 0x80, 0x25,
        0x17, 0x2b, 0xb4, 0x5b, 0x4a, 0x2f};
static uint8_t g_test_vector_cs_KcB[] =
    {
        0x96, 0xa8, 0x01, 0x67, 0x3b, 0xd0, 0x7b, 0x51, 0xd6, 0x1f,
        0xba, 0xea, 0x03, 0xef, 0x17, 0xcf};
static uint8_t g_test_vector_cs_MAC_A[] =
    {
        0xca, 0xb3, 0x7c, 0x89, 0x19, 0x2f, 0x9a, 0xd9, 0x0c, 0xa5,
        0xe6, 0xb8, 0xea, 0xdb, 0x13, 0x0d, 0x31, 0x3b, 0x51, 0xd2,
        0x4b, 0x78, 0x89, 0xe2, 0x53, 0x6f, 0x7c, 0x80, 0x02, 0x6e,
        0x07, 0x6a};
static uint8_t g_test_vector_cs_MAC_B[] =
    {
        0xf7, 0x07, 0x6a, 0x78, 0xa3, 0xd1, 0x6f, 0x0c, 0x62, 0xcb,
        0x9e, 0x40, 0xbd, 0x1a, 0x91, 0xb6, 0x8d, 0xee, 0x14, 0x4b,
        0x87, 0x01, 0x6e, 0x2d, 0xae, 0x81, 0xc3, 0x6e, 0x97, 0x3f,
        0x3b, 0x2e};

static uint8_t g_test_vector_c0_w0[] =
    {
        0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64, 0xf9, 0xdc, 0x7a, 0x01,
        0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab, 0xc4, 0xf9, 0xed, 0x56,
        0x88, 0x05, 0xca, 0x84, 0xf4, 0xed, 0x3e, 0xf8, 0x06, 0x51,
        0x6c, 0xf8};
static uint8_t g_test_vector_c0_w1[] =
    {
        0x8d, 0x73, 0xe4, 0xca, 0x27, 0x38, 0x59, 0xc8, 0x73, 0xd8,
        0x09, 0x43, 0x1d, 0x15, 0xf3, 0x0e, 0x2b, 0x72, 0x20, 0x07,
        0x96, 0x4e, 0x32, 0x69, 0x91, 0x60, 0xb5, 0x4f, 0xda, 0x3e,
        0xe8, 0x55};
static uint8_t g_test_vector_c0_L[] =
    {
        0x04, 0x91, 0xbb, 0x1e, 0x66, 0x72, 0xe7, 0x1a, 0xd8, 0x0b,
        0x17, 0xd1, 0x3f, 0x7a, 0x72, 0xca, 0x2f, 0xe7, 0xf8, 0x82,
        0xd4, 0xbd, 0x73, 0x4e, 0x2d, 0x14, 0x0f, 0x67, 0xab, 0x49,
        0xd2, 0xc3, 0xe7, 0x6d, 0xbc, 0xf7, 0x06, 0x95, 0x4b, 0xd9,
        0xad, 0xa4, 0xe3, 0xa7, 0xfc, 0x50, 0xcf, 0x92, 0x94, 0x72,
        0x9f, 0x93, 0xb1, 0x30, 0xad, 0xa3, 0xd3, 0xa4, 0xae, 0x98,
        0xcc, 0x7e, 0x7b, 0x69, 0x71};
static uint8_t g_test_vector_c0_X[] =
    {
        0x04, 0x26, 0xfb, 0xed, 0xb3, 0xb9, 0xcc, 0xea, 0x93, 0xd6,
        0x09, 0x83, 0x8d, 0xcc, 0x1d, 0x4b, 0xae, 0xbd, 0xbb, 0x9c,
        0x28, 0x77, 0x63, 0xed, 0x4c, 0xdb, 0x2d, 0x3c, 0xc7, 0x6f,
        0x78, 0x8d, 0x33, 0x88, 0xdb, 0x3d, 0xa1, 0xf6, 0x3e, 0x94,
        0x5f, 0x3f, 0x1b, 0xa1, 0x7f, 0x7b, 0x98, 0x6a, 0xb9, 0xed,
        0x31, 0x70, 0x35, 0x9e, 0xe4, 0x06, 0xcb, 0xb4, 0x0f, 0x3e,
        0x37, 0x19, 0x45, 0x3b, 0x15};
static uint8_t g_test_vector_c0_Y[] =
    {
        0x04, 0xd4, 0x96, 0x09, 0x22, 0x99, 0x0a, 0xcb, 0x87, 0x80,
        0x9e, 0x73, 0x4f, 0xed, 0x2c, 0x2c, 0xcb, 0x72, 0xfd, 0x26,
        0xed, 0x17, 0x3e, 0x82, 0x07, 0xcd, 0xc6, 0x22, 0x00, 0x73,
        0xac, 0x50, 0x17, 0x66, 0x07, 0x88, 0xe9, 0x6d, 0xb2, 0x75,
        0xf6, 0xed, 0xf2, 0xba, 0x40, 0x0d, 0x4e, 0x09, 0x02, 0x73,
        0xc2, 0x4d, 0xc9, 0x07, 0xd8, 0x0f, 0xf9, 0xca, 0xd7, 0xf4,
        0x2f, 0xd9, 0xf7, 0x9c, 0x3f};
static uint8_t g_test_vector_c0_Z[] =
    {
        0x04, 0x21, 0x99, 0x6f, 0xf4, 0xd9, 0xc0, 0x5b, 0x23, 0x89,
        0xae, 0x05, 0x11, 0x8c, 0x51, 0x96, 0x79, 0xdf, 0x5d, 0x6d,
        0xe2, 0x58, 0xb3, 0x1f, 0x2a, 0x17, 0xda, 0x76, 0x04, 0xc8,
        0xe3, 0xc1, 0x7b, 0xb3, 0xc4, 0xaa, 0xe2, 0xae, 0x42, 0x17,
        0x95, 0x1a, 0xa8, 0x21, 0x44, 0xcb, 0x8b, 0x67, 0x7b, 0xe8,
        0x06, 0x1f, 0x28, 0x89, 0x3f, 0x70, 0x21, 0x6c, 0x1e, 0x11,
        0xba, 0x2b, 0xac, 0xd5, 0x0d};
static uint8_t g_test_vector_c0_V[] =
    {
        0x04, 0x72, 0x9f, 0x7c, 0x6c, 0x5b, 0xd6, 0x83, 0x10, 0x34,
        0x5b, 0x1a, 0x10, 0xb8, 0x4e, 0xa7, 0xdb, 0x64, 0xc7, 0x04,
        0x41, 0xda, 0x22, 0x55, 0x99, 0x22, 0x08, 0xb7, 0xa8, 0xe0,
        0xb3, 0x9d, 0x4f, 0x0e, 0x63, 0x4a, 0xcf, 0x7d, 0x44, 0x0b,
        0x45, 0x52, 0xa4, 0x1d, 0xf2, 0x91, 0xac, 0x6a, 0x40, 0x9f,
        0x8c, 0xf5, 0xa4, 0x7c, 0xec, 0x9f, 0xed, 0x5f, 0x85, 0xfe,
        0xa1, 0x24, 0x13, 0x79, 0xa4};
static uint8_t g_test_vector_c0_TT[] =
    {
        0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x63, 0x6c,
        0x69, 0x65, 0x6e, 0x74, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x04, 0x26, 0xfb, 0xed, 0xb3, 0xb9, 0xcc, 0xea,
        0x93, 0xd6, 0x09, 0x83, 0x8d, 0xcc, 0x1d, 0x4b, 0xae, 0xbd,
        0xbb, 0x9c, 0x28, 0x77, 0x63, 0xed, 0x4c, 0xdb, 0x2d, 0x3c,
        0xc7, 0x6f, 0x78, 0x8d, 0x33, 0x88, 0xdb, 0x3d, 0xa1, 0xf6,
        0x3e, 0x94, 0x5f, 0x3f, 0x1b, 0xa1, 0x7f, 0x7b, 0x98, 0x6a,
        0xb9, 0xed, 0x31, 0x70, 0x35, 0x9e, 0xe4, 0x06, 0xcb, 0xb4,
        0x0f, 0x3e, 0x37, 0x19, 0x45, 0x3b, 0x15, 0x41, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0xd4, 0x96, 0x09, 0x22,
        0x99, 0x0a, 0xcb, 0x87, 0x80, 0x9e, 0x73, 0x4f, 0xed, 0x2c,
        0x2c, 0xcb, 0x72, 0xfd, 0x26, 0xed, 0x17, 0x3e, 0x82, 0x07,
        0xcd, 0xc6, 0x22, 0x00, 0x73, 0xac, 0x50, 0x17, 0x66, 0x07,
        0x88, 0xe9, 0x6d, 0xb2, 0x75, 0xf6, 0xed, 0xf2, 0xba, 0x40,
        0x0d, 0x4e, 0x09, 0x02, 0x73, 0xc2, 0x4d, 0xc9, 0x07, 0xd8,
        0x0f, 0xf9, 0xca, 0xd7, 0xf4, 0x2f, 0xd9, 0xf7, 0x9c, 0x3f,
        0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x21,
        0x99, 0x6f, 0xf4, 0xd9, 0xc0, 0x5b, 0x23, 0x89, 0xae, 0x05,
        0x11, 0x8c, 0x51, 0x96, 0x79, 0xdf, 0x5d, 0x6d, 0xe2, 0x58,
        0xb3, 0x1f, 0x2a, 0x17, 0xda, 0x76, 0x04, 0xc8, 0xe3, 0xc1,
        0x7b, 0xb3, 0xc4, 0xaa, 0xe2, 0xae, 0x42, 0x17, 0x95, 0x1a,
        0xa8, 0x21, 0x44, 0xcb, 0x8b, 0x67, 0x7b, 0xe8, 0x06, 0x1f,
        0x28, 0x89, 0x3f, 0x70, 0x21, 0x6c, 0x1e, 0x11, 0xba, 0x2b,
        0xac, 0xd5, 0x0d, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x04, 0x72, 0x9f, 0x7c, 0x6c, 0x5b, 0xd6, 0x83, 0x10,
        0x34, 0x5b, 0x1a, 0x10, 0xb8, 0x4e, 0xa7, 0xdb, 0x64, 0xc7,
        0x04, 0x41, 0xda, 0x22, 0x55, 0x99, 0x22, 0x08, 0xb7, 0xa8,
        0xe0, 0xb3, 0x9d, 0x4f, 0x0e, 0x63, 0x4a, 0xcf, 0x7d, 0x44,
        0x0b, 0x45, 0x52, 0xa4, 0x1d, 0xf2, 0x91, 0xac, 0x6a, 0x40,
        0x9f, 0x8c, 0xf5, 0xa4, 0x7c, 0xec, 0x9f, 0xed, 0x5f, 0x85,
        0xfe, 0xa1, 0x24, 0x13, 0x79, 0xa4, 0x20, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64,
        0xf9, 0xdc, 0x7a, 0x01, 0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab,
        0xc4, 0xf9, 0xed, 0x56, 0x88, 0x05, 0xca, 0x84, 0xf4, 0xed,
        0x3e, 0xf8, 0x06, 0x51, 0x6c, 0xf8};
static uint8_t g_test_vector_c0_Ka[] =
    {
        0xfd, 0x19, 0x10, 0x4b, 0x83, 0x6b, 0x0b, 0xa9, 0xdf, 0xaa,
        0xea, 0xb8, 0x86, 0x10, 0xbe, 0x57};
static uint8_t g_test_vector_c0_Ke[] =
    {
        0x90, 0x33, 0x73, 0x74, 0xf9, 0x74, 0xf6, 0x73, 0x70, 0x7d,
        0xe5, 0xba, 0x1b, 0x98, 0xe5, 0xb8};
static uint8_t g_test_vector_c0_KcA[] =
    {
        0x2e, 0x10, 0x24, 0x9c, 0x56, 0x66, 0x77, 0xc8, 0x82, 0x6b,
        0x48, 0xad, 0x10, 0xb1, 0x9b, 0xb5};
static uint8_t g_test_vector_c0_KcB[] =
    {
        0x4f, 0xca, 0xf8, 0xfd, 0x0b, 0xfc, 0xae, 0xea, 0xbb, 0x9d,
        0x6f, 0x48, 0xe2, 0x64, 0xe4, 0xa3};
static uint8_t g_test_vector_c0_MAC_A[] =
    {
        0xaa, 0xef, 0x20, 0x0e, 0xa5, 0xf5, 0xc4, 0x1e, 0x1f, 0xdb,
        0x9b, 0x34, 0x55, 0xdd, 0xe7, 0x15, 0xcd, 0x8a, 0xa9, 0x6f,
        0x8a, 0xfd, 0x32, 0x74, 0xf7, 0x15, 0x9c, 0x3c, 0x54, 0x88,
        0x7f, 0x2c};
static uint8_t g_test_vector_c0_MAC_B[] =
    {
        0x92, 0x6e, 0xad, 0xbf, 0x4b, 0x72, 0x0b, 0x46, 0xea, 0x62,
        0x2d, 0x71, 0x00, 0xe0, 0x01, 0x3e, 0xb2, 0x4d, 0x15, 0x91,
        0x49, 0x68, 0x46, 0xa6, 0x04, 0xcf, 0x90, 0xc1, 0x44, 0x6f,
        0xe0, 0xe4};

static uint8_t g_test_vector_0s_w0[] =
    {
        0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64, 0xf9, 0xdc, 0x7a, 0x01,
        0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab, 0xc4, 0xf9, 0xed, 0x56,
        0x88, 0x05, 0xca, 0x84, 0xf4, 0xed, 0x3e, 0xf8, 0x06, 0x51,
        0x6c, 0xf8};
static uint8_t g_test_vector_0s_w1[] =
    {
        0x8d, 0x73, 0xe4, 0xca, 0x27, 0x38, 0x59, 0xc8, 0x73, 0xd8,
        0x09, 0x43, 0x1d, 0x15, 0xf3, 0x0e, 0x2b, 0x72, 0x20, 0x07,
        0x96, 0x4e, 0x32, 0x69, 0x91, 0x60, 0xb5, 0x4f, 0xda, 0x3e,
        0xe8, 0x55};
static uint8_t g_test_vector_0s_L[] =
    {
        0x04, 0x91, 0xbb, 0x1e, 0x66, 0x72, 0xe7, 0x1a, 0xd8, 0x0b,
        0x17, 0xd1, 0x3f, 0x7a, 0x72, 0xca, 0x2f, 0xe7, 0xf8, 0x82,
        0xd4, 0xbd, 0x73, 0x4e, 0x2d, 0x14, 0x0f, 0x67, 0xab, 0x49,
        0xd2, 0xc3, 0xe7, 0x6d, 0xbc, 0xf7, 0x06, 0x95, 0x4b, 0xd9,
        0xad, 0xa4, 0xe3, 0xa7, 0xfc, 0x50, 0xcf, 0x92, 0x94, 0x72,
        0x9f, 0x93, 0xb1, 0x30, 0xad, 0xa3, 0xd3, 0xa4, 0xae, 0x98,
        0xcc, 0x7e, 0x7b, 0x69, 0x71};
static uint8_t g_test_vector_0s_X[] =
    {
        0x04, 0x63, 0xa7, 0x53, 0x1a, 0xcd, 0x20, 0x4e, 0x7d, 0x83,
        0xac, 0x65, 0x62, 0x27, 0x8d, 0x7c, 0xed, 0x01, 0xa7, 0x15,
        0xef, 0xf9, 0x37, 0xa2, 0x55, 0x20, 0xbd, 0x22, 0x20, 0xc6,
        0x26, 0x33, 0xdb, 0x0e, 0xa5, 0x10, 0x59, 0x1c, 0x5c, 0xd2,
        0x31, 0x59, 0xa7, 0xa9, 0x71, 0x81, 0xec, 0x24, 0x43, 0x3a,
        0xac, 0x6e, 0x62, 0x8f, 0x16, 0xd4, 0x2c, 0x45, 0x5f, 0xca,
        0xe6, 0x68, 0x41, 0x1e, 0x34};
static uint8_t g_test_vector_0s_Y[] =
    {
        0x04, 0x33, 0x62, 0x52, 0x17, 0xe2, 0xcc, 0xc0, 0xc5, 0x45,
        0x12, 0x6f, 0x75, 0x6d, 0x99, 0x9c, 0x16, 0xdf, 0x68, 0xb1,
        0x4b, 0x73, 0xb3, 0xfe, 0x47, 0x35, 0x93, 0xc1, 0xd3, 0xa0,
        0xd7, 0x28, 0x7b, 0x43, 0xb3, 0x53, 0x17, 0x78, 0x06, 0xc6,
        0x41, 0x58, 0x8e, 0xc9, 0x69, 0x85, 0x2b, 0x56, 0xb1, 0x71,
        0x90, 0xd6, 0xeb, 0xe8, 0x03, 0x13, 0xde, 0x74, 0xe5, 0xee,
        0xe0, 0xc1, 0x40, 0x30, 0x25};
static uint8_t g_test_vector_0s_Z[] =
    {
        0x04, 0x9e, 0xf5, 0xea, 0x46, 0xe8, 0xca, 0x42, 0xf3, 0xe8,
        0x22, 0xc5, 0x98, 0x85, 0x8c, 0xa3, 0x47, 0xbf, 0x19, 0xcc,
        0x74, 0xa8, 0xa1, 0xfb, 0xfd, 0x83, 0x6e, 0xc4, 0xd7, 0x7b,
        0xee, 0x7f, 0x0c, 0xd4, 0xd4, 0x2f, 0x4f, 0x81, 0x7c, 0xaa,
        0x33, 0x60, 0xc9, 0x18, 0xd2, 0x53, 0x8d, 0x7c, 0x96, 0xde,
        0x5d, 0xb4, 0x7a, 0x72, 0x94, 0x9c, 0xa2, 0x88, 0x8d, 0x02,
        0xc1, 0x8e, 0xa6, 0xf9, 0x2b};
static uint8_t g_test_vector_0s_V[] =
    {
        0x04, 0x08, 0xa7, 0x0f, 0xc9, 0xdc, 0xa8, 0x7b, 0x70, 0xa7,
        0xd4, 0xa0, 0x74, 0xbd, 0xcc, 0xa0, 0x22, 0x28, 0x06, 0xf0,
        0xca, 0xa0, 0x54, 0x2d, 0x8d, 0x62, 0xae, 0xcf, 0x53, 0x5e,
        0xa8, 0xff, 0xbc, 0x5e, 0x48, 0x41, 0x9c, 0x51, 0x27, 0xa0,
        0xf7, 0xf0, 0x36, 0x85, 0x01, 0x3c, 0x09, 0xd2, 0x2f, 0x79,
        0x75, 0x23, 0xd2, 0x6e, 0x7d, 0xb1, 0x59, 0xfe, 0xca, 0xcc,
        0xeb, 0xc5, 0x4e, 0xd2, 0xa7};
static uint8_t g_test_vector_0s_TT[] =
    {
        0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x65,
        0x72, 0x76, 0x65, 0x72, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x04, 0x63, 0xa7, 0x53, 0x1a, 0xcd, 0x20, 0x4e,
        0x7d, 0x83, 0xac, 0x65, 0x62, 0x27, 0x8d, 0x7c, 0xed, 0x01,
        0xa7, 0x15, 0xef, 0xf9, 0x37, 0xa2, 0x55, 0x20, 0xbd, 0x22,
        0x20, 0xc6, 0x26, 0x33, 0xdb, 0x0e, 0xa5, 0x10, 0x59, 0x1c,
        0x5c, 0xd2, 0x31, 0x59, 0xa7, 0xa9, 0x71, 0x81, 0xec, 0x24,
        0x43, 0x3a, 0xac, 0x6e, 0x62, 0x8f, 0x16, 0xd4, 0x2c, 0x45,
        0x5f, 0xca, 0xe6, 0x68, 0x41, 0x1e, 0x34, 0x41, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x33, 0x62, 0x52, 0x17,
        0xe2, 0xcc, 0xc0, 0xc5, 0x45, 0x12, 0x6f, 0x75, 0x6d, 0x99,
        0x9c, 0x16, 0xdf, 0x68, 0xb1, 0x4b, 0x73, 0xb3, 0xfe, 0x47,
        0x35, 0x93, 0xc1, 0xd3, 0xa0, 0xd7, 0x28, 0x7b, 0x43, 0xb3,
        0x53, 0x17, 0x78, 0x06, 0xc6, 0x41, 0x58, 0x8e, 0xc9, 0x69,
        0x85, 0x2b, 0x56, 0xb1, 0x71, 0x90, 0xd6, 0xeb, 0xe8, 0x03,
        0x13, 0xde, 0x74, 0xe5, 0xee, 0xe0, 0xc1, 0x40, 0x30, 0x25,
        0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x9e,
        0xf5, 0xea, 0x46, 0xe8, 0xca, 0x42, 0xf3, 0xe8, 0x22, 0xc5,
        0x98, 0x85, 0x8c, 0xa3, 0x47, 0xbf, 0x19, 0xcc, 0x74, 0xa8,
        0xa1, 0xfb, 0xfd, 0x83, 0x6e, 0xc4, 0xd7, 0x7b, 0xee, 0x7f,
        0x0c, 0xd4, 0xd4, 0x2f, 0x4f, 0x81, 0x7c, 0xaa, 0x33, 0x60,
        0xc9, 0x18, 0xd2, 0x53, 0x8d, 0x7c, 0x96, 0xde, 0x5d, 0xb4,
        0x7a, 0x72, 0x94, 0x9c, 0xa2, 0x88, 0x8d, 0x02, 0xc1, 0x8e,
        0xa6, 0xf9, 0x2b, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x04, 0x08, 0xa7, 0x0f, 0xc9, 0xdc, 0xa8, 0x7b, 0x70,
        0xa7, 0xd4, 0xa0, 0x74, 0xbd, 0xcc, 0xa0, 0x22, 0x28, 0x06,
        0xf0, 0xca, 0xa0, 0x54, 0x2d, 0x8d, 0x62, 0xae, 0xcf, 0x53,
        0x5e, 0xa8, 0xff, 0xbc, 0x5e, 0x48, 0x41, 0x9c, 0x51, 0x27,
        0xa0, 0xf7, 0xf0, 0x36, 0x85, 0x01, 0x3c, 0x09, 0xd2, 0x2f,
        0x79, 0x75, 0x23, 0xd2, 0x6e, 0x7d, 0xb1, 0x59, 0xfe, 0xca,
        0xcc, 0xeb, 0xc5, 0x4e, 0xd2, 0xa7, 0x20, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64,
        0xf9, 0xdc, 0x7a, 0x01, 0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab,
        0xc4, 0xf9, 0xed, 0x56, 0x88, 0x05, 0xca, 0x84, 0xf4, 0xed,
        0x3e, 0xf8, 0x06, 0x51, 0x6c, 0xf8};
static uint8_t g_test_vector_0s_Ka[] =
    {
        0x5c, 0x85, 0x90, 0x08, 0x98, 0xb2, 0x07, 0x9c, 0x9d, 0xe0,
        0x9e, 0xbe, 0xf6, 0x3c, 0xeb, 0xd1};
static uint8_t g_test_vector_0s_Ke[] =
    {
        0x13, 0xc8, 0x12, 0x47, 0x68, 0x59, 0xe9, 0x09, 0x68, 0x2c,
        0x3b, 0xe7, 0x43, 0x6b, 0xfe, 0xf0};
static uint8_t g_test_vector_0s_KcA[] =
    {
        0x77, 0xbd, 0x63, 0x6a, 0xb9, 0xbf, 0x15, 0x33, 0x39, 0xc5,
        0x72, 0x4e, 0xe0, 0x4f, 0x87, 0xa7};
static uint8_t g_test_vector_0s_KcB[] =
    {
        0x19, 0x43, 0x25, 0xb2, 0x7d, 0x7c, 0x29, 0x1c, 0x94, 0xa6,
        0x89, 0xdd, 0xaf, 0xea, 0xaa, 0x3c};
static uint8_t g_test_vector_0s_MAC_A[] =
    {
        0x3b, 0xb6, 0x12, 0x48, 0xa1, 0xfd, 0x29, 0x46, 0x74, 0x33,
        0x14, 0x84, 0x8f, 0xc5, 0x01, 0xeb, 0x34, 0x55, 0xeb, 0x11,
        0x3b, 0xd8, 0x96, 0x6e, 0x20, 0x0d, 0xe1, 0x4d, 0x5e, 0x41,
        0x26, 0x88};
static uint8_t g_test_vector_0s_MAC_B[] =
    {
        0x3e, 0x79, 0x12, 0xbd, 0x2a, 0x85, 0xa1, 0xf5, 0x6d, 0x36,
        0xfb, 0xb1, 0x6d, 0xe2, 0x98, 0x34, 0xb0, 0x00, 0xd4, 0x9e,
        0x50, 0xd4, 0xc1, 0x7f, 0x99, 0x29, 0x42, 0xee, 0x59, 0x25,
        0x5f, 0x1e};

static uint8_t g_test_vector_00_w0[] =
    {
        0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64, 0xf9, 0xdc, 0x7a, 0x01,
        0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab, 0xc4, 0xf9, 0xed, 0x56,
        0x88, 0x05, 0xca, 0x84, 0xf4, 0xed, 0x3e, 0xf8, 0x06, 0x51,
        0x6c, 0xf8};
static uint8_t g_test_vector_00_w1[] =
    {
        0x8d, 0x73, 0xe4, 0xca, 0x27, 0x38, 0x59, 0xc8, 0x73, 0xd8,
        0x09, 0x43, 0x1d, 0x15, 0xf3, 0x0e, 0x2b, 0x72, 0x20, 0x07,
        0x96, 0x4e, 0x32, 0x69, 0x91, 0x60, 0xb5, 0x4f, 0xda, 0x3e,
        0xe8, 0x55};
static uint8_t g_test_vector_00_L[] =
    {
        0x04, 0x91, 0xbb, 0x1e, 0x66, 0x72, 0xe7, 0x1a, 0xd8, 0x0b,
        0x17, 0xd1, 0x3f, 0x7a, 0x72, 0xca, 0x2f, 0xe7, 0xf8, 0x82,
        0xd4, 0xbd, 0x73, 0x4e, 0x2d, 0x14, 0x0f, 0x67, 0xab, 0x49,
        0xd2, 0xc3, 0xe7, 0x6d, 0xbc, 0xf7, 0x06, 0x95, 0x4b, 0xd9,
        0xad, 0xa4, 0xe3, 0xa7, 0xfc, 0x50, 0xcf, 0x92, 0x94, 0x72,
        0x9f, 0x93, 0xb1, 0x30, 0xad, 0xa3, 0xd3, 0xa4, 0xae, 0x98,
        0xcc, 0x7e, 0x7b, 0x69, 0x71};
static uint8_t g_test_vector_00_X[] =
    {
        0x04, 0xf6, 0x0f, 0x50, 0x6c, 0xfa, 0x07, 0x50, 0x6d, 0x4b,
        0xfd, 0x2b, 0x3f, 0x56, 0x03, 0x8b, 0x1c, 0x00, 0x1f, 0xe6,
        0x82, 0x63, 0x74, 0x12, 0x2c, 0x30, 0xe9, 0x14, 0x74, 0x7e,
        0xab, 0x64, 0x79, 0x88, 0x70, 0x2c, 0xc7, 0x02, 0x10, 0xeb,
        0x2a, 0xa6, 0x25, 0xe6, 0x03, 0xd5, 0x69, 0x61, 0xaf, 0x16,
        0xec, 0x54, 0x3e, 0xe3, 0xd4, 0xd2, 0xcb, 0x90, 0xd6, 0xfe,
        0x2f, 0x3c, 0x1d, 0x11, 0x80};
static uint8_t g_test_vector_00_Y[] =
    {
        0x04, 0x68, 0x98, 0xfa, 0xfe, 0xf3, 0x4f, 0xff, 0x99, 0x36,
        0x21, 0x76, 0x08, 0x15, 0x1a, 0xf0, 0x83, 0x13, 0x30, 0x5c,
        0xf8, 0xe6, 0xf9, 0xad, 0xd1, 0x0d, 0x72, 0x1c, 0x04, 0xa0,
        0x18, 0x60, 0x7f, 0x5b, 0x5a, 0xca, 0x32, 0x7e, 0x15, 0x0c,
        0xd5, 0xd5, 0x88, 0xde, 0x83, 0xe4, 0x64, 0x91, 0xec, 0x76,
        0x6e, 0x2c, 0xf8, 0x7d, 0xa9, 0xfb, 0x07, 0xdc, 0x37, 0x45,
        0xc0, 0x63, 0x0b, 0x03, 0xbb};
static uint8_t g_test_vector_00_Z[] =
    {
        0x04, 0x2a, 0xde, 0xee, 0xa1, 0x41, 0x7c, 0xc6, 0xc5, 0x92,
        0xfe, 0xf7, 0x72, 0xda, 0x8b, 0xa0, 0xf3, 0xae, 0xa6, 0x9a,
        0x5f, 0xb1, 0x59, 0x23, 0xd0, 0xe9, 0xae, 0x7c, 0x33, 0x01,
        0xc7, 0xff, 0x87, 0xe9, 0xff, 0x9f, 0xba, 0x29, 0x2a, 0xd4,
        0x10, 0xe4, 0xaf, 0x71, 0x77, 0x08, 0x58, 0xe9, 0xa3, 0x14,
        0xf1, 0xde, 0xb7, 0x5f, 0x77, 0xbd, 0xe2, 0x76, 0xd3, 0xcc,
        0x8b, 0x45, 0xff, 0xd7, 0x0c};
static uint8_t g_test_vector_00_V[] =
    {
        0x04, 0x84, 0x5c, 0x13, 0x0c, 0x8c, 0x20, 0x86, 0x58, 0x28,
        0xe2, 0x1e, 0xd3, 0x40, 0x0a, 0xbe, 0xa7, 0x26, 0xb0, 0x7f,
        0xde, 0xb7, 0x53, 0x3f, 0xa6, 0x01, 0x7a, 0xcc, 0xc3, 0x7e,
        0x0b, 0xe4, 0x92, 0x22, 0x41, 0xda, 0xd4, 0x48, 0x46, 0x11,
        0x2e, 0x42, 0xbe, 0xe9, 0x99, 0x50, 0x1f, 0xdb, 0x4d, 0x09,
        0xfc, 0x79, 0x8e, 0x46, 0x77, 0xd4, 0x03, 0xd1, 0x0b, 0xfa,
        0x86, 0x29, 0x28, 0x58, 0x4e};
static uint8_t g_test_vector_00_TT[] =
    {
        0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0xf6,
        0x0f, 0x50, 0x6c, 0xfa, 0x07, 0x50, 0x6d, 0x4b, 0xfd, 0x2b,
        0x3f, 0x56, 0x03, 0x8b, 0x1c, 0x00, 0x1f, 0xe6, 0x82, 0x63,
        0x74, 0x12, 0x2c, 0x30, 0xe9, 0x14, 0x74, 0x7e, 0xab, 0x64,
        0x79, 0x88, 0x70, 0x2c, 0xc7, 0x02, 0x10, 0xeb, 0x2a, 0xa6,
        0x25, 0xe6, 0x03, 0xd5, 0x69, 0x61, 0xaf, 0x16, 0xec, 0x54,
        0x3e, 0xe3, 0xd4, 0xd2, 0xcb, 0x90, 0xd6, 0xfe, 0x2f, 0x3c,
        0x1d, 0x11, 0x80, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x04, 0x68, 0x98, 0xfa, 0xfe, 0xf3, 0x4f, 0xff, 0x99,
        0x36, 0x21, 0x76, 0x08, 0x15, 0x1a, 0xf0, 0x83, 0x13, 0x30,
        0x5c, 0xf8, 0xe6, 0xf9, 0xad, 0xd1, 0x0d, 0x72, 0x1c, 0x04,
        0xa0, 0x18, 0x60, 0x7f, 0x5b, 0x5a, 0xca, 0x32, 0x7e, 0x15,
        0x0c, 0xd5, 0xd5, 0x88, 0xde, 0x83, 0xe4, 0x64, 0x91, 0xec,
        0x76, 0x6e, 0x2c, 0xf8, 0x7d, 0xa9, 0xfb, 0x07, 0xdc, 0x37,
        0x45, 0xc0, 0x63, 0x0b, 0x03, 0xbb, 0x41, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x04, 0x2a, 0xde, 0xee, 0xa1, 0x41,
        0x7c, 0xc6, 0xc5, 0x92, 0xfe, 0xf7, 0x72, 0xda, 0x8b, 0xa0,
        0xf3, 0xae, 0xa6, 0x9a, 0x5f, 0xb1, 0x59, 0x23, 0xd0, 0xe9,
        0xae, 0x7c, 0x33, 0x01, 0xc7, 0xff, 0x87, 0xe9, 0xff, 0x9f,
        0xba, 0x29, 0x2a, 0xd4, 0x10, 0xe4, 0xaf, 0x71, 0x77, 0x08,
        0x58, 0xe9, 0xa3, 0x14, 0xf1, 0xde, 0xb7, 0x5f, 0x77, 0xbd,
        0xe2, 0x76, 0xd3, 0xcc, 0x8b, 0x45, 0xff, 0xd7, 0x0c, 0x41,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x84, 0x5c,
        0x13, 0x0c, 0x8c, 0x20, 0x86, 0x58, 0x28, 0xe2, 0x1e, 0xd3,
        0x40, 0x0a, 0xbe, 0xa7, 0x26, 0xb0, 0x7f, 0xde, 0xb7, 0x53,
        0x3f, 0xa6, 0x01, 0x7a, 0xcc, 0xc3, 0x7e, 0x0b, 0xe4, 0x92,
        0x22, 0x41, 0xda, 0xd4, 0x48, 0x46, 0x11, 0x2e, 0x42, 0xbe,
        0xe9, 0x99, 0x50, 0x1f, 0xdb, 0x4d, 0x09, 0xfc, 0x79, 0x8e,
        0x46, 0x77, 0xd4, 0x03, 0xd1, 0x0b, 0xfa, 0x86, 0x29, 0x28,
        0x58, 0x4e, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x4f, 0x9e, 0x28, 0x32, 0x2a, 0x64, 0xf9, 0xdc, 0x7a, 0x01,
        0xb2, 0x82, 0xcc, 0x51, 0xe2, 0xab, 0xc4, 0xf9, 0xed, 0x56,
        0x88, 0x05, 0xca, 0x84, 0xf4, 0xed, 0x3e, 0xf8, 0x06, 0x51,
        0x6c, 0xf8};
static uint8_t g_test_vector_00_Ka[] =
    {
        0x85, 0x0a, 0x18, 0xa7, 0x7b, 0x14, 0xef, 0x5e, 0x71, 0xb4,
        0xa2, 0x39, 0x41, 0x36, 0x30, 0xa8};
static uint8_t g_test_vector_00_Ke[] =
    {
        0x44, 0x54, 0x81, 0x92, 0x82, 0xb3, 0xe8, 0x86, 0xa7, 0xe6,
        0x5b, 0x7b, 0x0d, 0xe7, 0xcc, 0x62};
static uint8_t g_test_vector_00_KcA[] =
    {
        0x05, 0xdf, 0x61, 0x96, 0xc1, 0x2d, 0x62, 0x03, 0x76, 0x8c,
        0x73, 0xd8, 0x75, 0xe2, 0xbf, 0xc5};
static uint8_t g_test_vector_00_KcB[] =
    {
        0xb5, 0x8e, 0x61, 0xc3, 0x22, 0xf6, 0x85, 0xad, 0xd0, 0x2c,
        0x12, 0x57, 0x67, 0xe4, 0xfb, 0xb7};
static uint8_t g_test_vector_00_MAC_A[] =
    {
        0x33, 0xe5, 0x0d, 0x29, 0xf8, 0xea, 0xcc, 0x67, 0xbf, 0xda,
        0xb4, 0xa6, 0xc4, 0x6c, 0x88, 0xd7, 0x5a, 0xc3, 0x30, 0x84,
        0x16, 0xc6, 0x4d, 0xfb, 0xb0, 0xd7, 0xfb, 0x1c, 0x0f, 0xed,
        0xa5, 0xb0};
static uint8_t g_test_vector_00_MAC_B[] =
    {
        0x55, 0x43, 0x4e, 0x5e, 0x50, 0x1a, 0xd2, 0xd4, 0x76, 0xaa,
        0x1a, 0xe3, 0x34, 0xef, 0x27, 0xba, 0x43, 0x7a, 0x5d, 0xea,
        0x87, 0x68, 0x3d, 0xef, 0xac, 0x57, 0x5a, 0x63, 0xb5, 0x48,
        0xca, 0x64};

static t_test_vector g_test_vector_cs =
    {
        .w0 = g_test_vector_cs_w0,
        .w0_len = sizeof(g_test_vector_cs_w0),
        .w1 = g_test_vector_cs_w1,
        .w1_len = sizeof(g_test_vector_cs_w1),
        .L = g_test_vector_cs_L,
        .L_len = sizeof(g_test_vector_cs_L),
        .X = g_test_vector_cs_X,
        .X_len = sizeof(g_test_vector_cs_X),
        .Y = g_test_vector_cs_Y,
        .Y_len = sizeof(g_test_vector_cs_Y),
        .Z = g_test_vector_cs_Z,
        .Z_len = sizeof(g_test_vector_cs_Z),
        .V = g_test_vector_cs_V,
        .V_len = sizeof(g_test_vector_cs_V),
        .TT = g_test_vector_cs_TT,
        .TT_len = sizeof(g_test_vector_cs_TT),
        .Ka = g_test_vector_cs_Ka,
        .Ka_len = sizeof(g_test_vector_cs_Ka),
        .Ke = g_test_vector_cs_Ke,
        .Ke_len = sizeof(g_test_vector_cs_Ke),
        .KcA = g_test_vector_cs_KcA,
        .KcA_len = sizeof(g_test_vector_cs_KcA),
        .KcB = g_test_vector_cs_KcB,
        .KcB_len = sizeof(g_test_vector_cs_KcB),
        .MAC_A = g_test_vector_cs_MAC_A,
        .MAC_A_len = sizeof(g_test_vector_cs_MAC_A),
        .MAC_B = g_test_vector_cs_MAC_B,
        .MAC_B_len = sizeof(g_test_vector_cs_MAC_B),
};
static t_test_vector g_test_vector_c0 =
    {
        .w0 = g_test_vector_c0_w0,
        .w0_len = sizeof(g_test_vector_c0_w0),
        .w1 = g_test_vector_c0_w1,
        .w1_len = sizeof(g_test_vector_c0_w1),
        .L = g_test_vector_c0_L,
        .L_len = sizeof(g_test_vector_c0_L),
        .X = g_test_vector_c0_X,
        .X_len = sizeof(g_test_vector_c0_X),
        .Y = g_test_vector_c0_Y,
        .Y_len = sizeof(g_test_vector_c0_Y),
        .Z = g_test_vector_c0_Z,
        .Z_len = sizeof(g_test_vector_c0_Z),
        .V = g_test_vector_c0_V,
        .V_len = sizeof(g_test_vector_c0_V),
        .TT = g_test_vector_c0_TT,
        .TT_len = sizeof(g_test_vector_c0_TT),
        .Ka = g_test_vector_c0_Ka,
        .Ka_len = sizeof(g_test_vector_c0_Ka),
        .Ke = g_test_vector_c0_Ke,
        .Ke_len = sizeof(g_test_vector_c0_Ke),
        .KcA = g_test_vector_c0_KcA,
        .KcA_len = sizeof(g_test_vector_c0_KcA),
        .KcB = g_test_vector_c0_KcB,
        .KcB_len = sizeof(g_test_vector_c0_KcB),
        .MAC_A = g_test_vector_c0_MAC_A,
        .MAC_A_len = sizeof(g_test_vector_c0_MAC_A),
        .MAC_B = g_test_vector_c0_MAC_B,
        .MAC_B_len = sizeof(g_test_vector_c0_MAC_B),
};
static t_test_vector g_test_vector_0s =
    {
        .w0 = g_test_vector_0s_w0,
        .w0_len = sizeof(g_test_vector_0s_w0),
        .w1 = g_test_vector_0s_w1,
        .w1_len = sizeof(g_test_vector_0s_w1),
        .L = g_test_vector_0s_L,
        .L_len = sizeof(g_test_vector_0s_L),
        .X = g_test_vector_0s_X,
        .X_len = sizeof(g_test_vector_0s_X),
        .Y = g_test_vector_0s_Y,
        .Y_len = sizeof(g_test_vector_0s_Y),
        .Z = g_test_vector_0s_Z,
        .Z_len = sizeof(g_test_vector_0s_Z),
        .V = g_test_vector_0s_V,
        .V_len = sizeof(g_test_vector_0s_V),
        .TT = g_test_vector_0s_TT,
        .TT_len = sizeof(g_test_vector_0s_TT),
        .Ka = g_test_vector_0s_Ka,
        .Ka_len = sizeof(g_test_vector_0s_Ka),
        .Ke = g_test_vector_0s_Ke,
        .Ke_len = sizeof(g_test_vector_0s_Ke),
        .KcA = g_test_vector_0s_KcA,
        .KcA_len = sizeof(g_test_vector_0s_KcA),
        .KcB = g_test_vector_0s_KcB,
        .KcB_len = sizeof(g_test_vector_0s_KcB),
        .MAC_A = g_test_vector_0s_MAC_A,
        .MAC_A_len = sizeof(g_test_vector_0s_MAC_A),
        .MAC_B = g_test_vector_0s_MAC_B,
        .MAC_B_len = sizeof(g_test_vector_0s_MAC_B),
};
static t_test_vector g_test_vector_00 =
    {
        .w0 = g_test_vector_00_w0,
        .w0_len = sizeof(g_test_vector_00_w0),
        .w1 = g_test_vector_00_w1,
        .w1_len = sizeof(g_test_vector_00_w1),
        .L = g_test_vector_00_L,
        .L_len = sizeof(g_test_vector_00_L),
        .X = g_test_vector_00_X,
        .X_len = sizeof(g_test_vector_00_X),
        .Y = g_test_vector_00_Y,
        .Y_len = sizeof(g_test_vector_00_Y),
        .Z = g_test_vector_00_Z,
        .Z_len = sizeof(g_test_vector_00_Z),
        .V = g_test_vector_00_V,
        .V_len = sizeof(g_test_vector_00_V),
        .TT = g_test_vector_00_TT,
        .TT_len = sizeof(g_test_vector_00_TT),
        .Ka = g_test_vector_00_Ka,
        .Ka_len = sizeof(g_test_vector_00_Ka),
        .Ke = g_test_vector_00_Ke,
        .Ke_len = sizeof(g_test_vector_00_Ke),
        .KcA = g_test_vector_00_KcA,
        .KcA_len = sizeof(g_test_vector_00_KcA),
        .KcB = g_test_vector_00_KcB,
        .KcB_len = sizeof(g_test_vector_00_KcB),
        .MAC_A = g_test_vector_00_MAC_A,
        .MAC_A_len = sizeof(g_test_vector_00_MAC_A),
        .MAC_B = g_test_vector_00_MAC_B,
        .MAC_B_len = sizeof(g_test_vector_00_MAC_B),
};

#define GROUP_DEFAULT SPAKE2PLUS_GROUP_P256_SEARCH_NAME
#define MAC_DEFAULT SPAKE2PLUS_HMAC_SEARCH_NAME
#define HASH_DEFAULT SPAKE2PLUS_HASH_SHA256_SEARCH_NAME

static void default_setup(char *client_id, char *server_id)
{
    int res = spake2plus_init(
        &spake2_instance,
        client_id,
        strlen(client_id),
        server_id,
        strlen(server_id),
        g_aad_ptr,
        strlen(g_aad_ptr),
        GROUP_DEFAULT,
        HASH_DEFAULT,
        MAC_DEFAULT,
        SPAKE2PLUS_SERVER);
    TEST_ASSERT_MESSAGE(res == SPAKE2PLUS_OK, "Default initialization failed!");
    res = spake2plus_pwd_init(
        spake2_instance,
        g_pw_ptr,
        strlen(g_pw_ptr));
    TEST_ASSERT_MESSAGE(res == SPAKE2PLUS_OK, "Default password initialization failed!");
    res = spake2plus_setup_protocol(
        spake2_instance);
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_own_pA_or_pB(NULL, &g_pA_or_pB_len, spake2_instance));
    TEST_ASSERT(NULL != (g_pA_or_pB = malloc(g_pA_or_pB_len)));
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_own_pA_or_pB(g_pA_or_pB, &g_pA_or_pB_len, spake2_instance));

    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, res, "Default protocol setup failed!");

    res = spake2plus_init(
        &spake2_client_inst,
        client_id,
        strlen(client_id),
        server_id,
        strlen(server_id),
        g_aad_ptr,
        strlen(g_aad_ptr),
        GROUP_DEFAULT,
        HASH_DEFAULT,
        MAC_DEFAULT,
        SPAKE2PLUS_CLIENT);
    TEST_ASSERT_MESSAGE(res == SPAKE2PLUS_OK, "Default initialization failed!");

    res = spake2plus_pwd_init(
        spake2_client_inst,
        g_pw_ptr,
        strlen(g_pw_ptr));
    TEST_ASSERT_MESSAGE(res == SPAKE2PLUS_OK, "Default password initialization failed!");

    res = spake2plus_setup_protocol(
        spake2_client_inst);
    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, res, "Default protocol setup failed!");
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_own_pA_or_pB(NULL, &g_pA_or_pB_client_len, spake2_client_inst));
    TEST_ASSERT(NULL != (g_pA_or_pB_client = malloc(g_pA_or_pB_client_len)));
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_own_pA_or_pB(g_pA_or_pB_client, &g_pA_or_pB_client_len, spake2_client_inst));
}
static void default_init_with_test_vector(t_test_vector *tv, char *client_id, char *server_id)
{
    TEST_ASSERT(NULL != (g_ctx = BN_CTX_secure_new()));
    BN_CTX_start(g_ctx);

    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "Here the test vectors are inserted.\n");
    TEST_ASSERT(NULL != BN_bin2bn((unsigned char *)tv->w0, tv->w0_len, spake2_instance->w0));
    TEST_ASSERT(NULL != BN_bin2bn((unsigned char *)tv->w1, tv->w1_len, spake2_instance->w1));
    //Set L from test vectors, it cannot be checked separately
    spake2plus_set_ec_point_from_uncompressed(
        spake2_instance->group,
        spake2_instance->L,
        tv->L,
        tv->L_len);
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_instance, spake2_instance->L,
                                                           POINT_CONVERSION_UNCOMPRESSED, "below is L:\n"));
    //pA
    spake2plus_set_ec_point_from_uncompressed(
        spake2_instance->group,
        spake2_instance->pA,
        tv->X,
        tv->X_len);
    spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_instance, spake2_instance->pA,
                              POINT_CONVERSION_UNCOMPRESSED, "below is X:\n");
    //pB
    spake2plus_set_ec_point_from_uncompressed(
        spake2_instance->group,
        spake2_instance->pB,
        tv->Y,
        tv->Y_len);
    spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_instance, spake2_instance->pB,
                              POINT_CONVERSION_UNCOMPRESSED, "below is Y:\n");

    OPENSSL_secure_free(spake2_instance->idA);
    OPENSSL_secure_free(spake2_instance->idB);
    spake2_instance->idA_len = strlen(client_id);
    spake2_instance->idB_len = strlen(server_id);
    TEST_ASSERT(NULL != (spake2_instance->idA = OPENSSL_secure_malloc(spake2_instance->idA_len)));
    TEST_ASSERT(NULL != (spake2_instance->idB = OPENSSL_secure_malloc(spake2_instance->idB_len)));
    memcpy(spake2_instance->idA, client_id, spake2_instance->idA_len);
    memcpy(spake2_instance->idB, server_id, spake2_instance->idB_len);

    TEST_ASSERT(NULL != BN_bin2bn((unsigned char *)tv->w0, tv->w0_len, spake2_client_inst->w0));
    TEST_ASSERT(NULL != BN_bin2bn((unsigned char *)tv->w1, tv->w1_len, spake2_client_inst->w1));

    //Set L from test vectors, it cannot be checked separately
    spake2plus_set_ec_point_from_uncompressed(
        spake2_client_inst->group,
        spake2_client_inst->L,
        tv->L,
        tv->L_len);
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_client_inst, spake2_client_inst->L,
                                                           POINT_CONVERSION_UNCOMPRESSED, "below is L:\n"));
    //pA
    spake2plus_set_ec_point_from_uncompressed(
        spake2_client_inst->group,
        spake2_client_inst->pA,
        tv->X,
        tv->X_len);
    spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_client_inst, spake2_client_inst->pA,
                              POINT_CONVERSION_UNCOMPRESSED, "below is X:\n");
    //pB
    spake2plus_set_ec_point_from_uncompressed(
        spake2_client_inst->group,
        spake2_client_inst->pB,
        tv->Y,
        tv->Y_len);
    spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_client_inst, spake2_client_inst->pB,
                              POINT_CONVERSION_UNCOMPRESSED, "below is Y:\n");

    OPENSSL_secure_free(spake2_client_inst->idA);
    OPENSSL_secure_free(spake2_client_inst->idB);
    spake2_client_inst->idA_len = strlen(client_id);
    spake2_client_inst->idB_len = strlen(server_id);
    TEST_ASSERT(NULL != (spake2_client_inst->idA = OPENSSL_secure_malloc(spake2_client_inst->idA_len)));
    TEST_ASSERT(NULL != (spake2_client_inst->idB = OPENSSL_secure_malloc(spake2_client_inst->idB_len)));
    memcpy(spake2_client_inst->idA, client_id, spake2_client_inst->idA_len);
    memcpy(spake2_client_inst->idB, server_id, spake2_client_inst->idB_len);

    OPENSSL_secure_free(g_pA_or_pB_client);
    OPENSSL_secure_free(g_pA_or_pB);

    TEST_ASSERT(NULL != (g_pA_or_pB = OPENSSL_secure_malloc(tv->Y_len)));
    TEST_ASSERT(NULL != (g_pA_or_pB_client = OPENSSL_secure_malloc(tv->Y_len)));

    TEST_ASSERT(NULL != (memcpy(g_pA_or_pB, tv->Y, tv->Y_len)));
    TEST_ASSERT(NULL != (memcpy(g_pA_or_pB_client, tv->X, tv->X_len)));

    TEST_ASSERT(NULL != (g_Z = EC_POINT_new(spake2_client_inst->group)));
    TEST_ASSERT(NULL != (g_V = EC_POINT_new(spake2_client_inst->group)));
    TEST_ASSERT(NULL != (g_test_vector_Z = EC_POINT_new(spake2_client_inst->group)));
    TEST_ASSERT(NULL != (g_test_vector_V = EC_POINT_new(spake2_client_inst->group)));

    spake2plus_set_ec_point_from_uncompressed(
        spake2_client_inst->group,
        g_test_vector_V,
        tv->V,
        tv->V_len);
    spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_client_inst, g_test_vector_V,
                              POINT_CONVERSION_UNCOMPRESSED,
                              "[COMMON_DEBUG]: below is V from test_vector:\n");

    spake2plus_set_ec_point_from_uncompressed(
        spake2_client_inst->group,
        g_test_vector_Z,
        tv->Z,
        tv->Z_len);
    spake2plus_print_ec_point(COMMON_DEBUG, NULL, spake2_client_inst, g_test_vector_Z,
                              POINT_CONVERSION_UNCOMPRESSED,
                              "[COMMON_DEBUG]: below is Z from test_vector:\n");
}

static void get_and_check_TT(t_test_vector *tv)
{
    //Checking TT on server
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_generate_TT(
                                     &g_TT, &g_TT_len, spake2_instance, g_test_vector_Z, g_test_vector_V));
    TEST_ASSERT_EQUAL_MESSAGE(tv->TT_len, g_TT_len, "sc: Obtained server TT length does not match the length of TT from test vectors!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(g_TT, tv->TT, g_TT_len), "sc: Obtained server TT does not match TT from test vectors!");
    OPENSSL_CHECK_NULL_AND_FREE(g_TT);

    //Checking TT on client
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_generate_TT(
                                     &g_TT, &g_TT_len, spake2_client_inst, g_test_vector_Z, g_test_vector_V));
    TEST_ASSERT_EQUAL_MESSAGE(tv->TT_len, g_TT_len, "sc: Obtained client TT length does not match the length of TT from test vectors!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(g_TT, tv->TT, g_TT_len), "sc: Obtained client TT does not match TT from test vectors!");
}

static void get_and_check_hash_of_TT(t_test_vector *tv)
{

    //Calculating Hash of TT with server
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_hash(
                                     (unsigned char *)g_md_value,
                                     &g_md_len,
                                     spake2_instance,
                                     (unsigned char *)g_TT,
                                     g_TT_len));
    TEST_ASSERT_MESSAGE((!(g_md_len & 1)), "sc: Obtained server Ke and Ka length is odd!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->Ke_len, (g_md_len / 2), "sc: Obtained server Ke length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->Ka_len, (g_md_len / 2), "sc: Obtained server Ka length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->Ka, g_md_value, (g_md_len / 2)), "sc: Obtained server Ka does not match corresponding test vector!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->Ke, g_md_value + (g_md_len / 2), (g_md_len / 2)), "sc: Obtained server Ke does not match corresponding test vector!");

    //Calculating Hash of TT with client
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_hash(
                                     (unsigned char *)g_md_value,
                                     &g_md_len,
                                     spake2_client_inst,
                                     (unsigned char *)g_TT,
                                     g_TT_len));
    TEST_ASSERT_MESSAGE((!(g_md_len & 1)), "sc: Obtained client Ke and Ka length is odd!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->Ke_len, (g_md_len / 2), "sc: Obtained client Ke length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->Ka_len, (g_md_len / 2), "sc: Obtained client Ka length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->Ka, g_md_value, (g_md_len / 2)), "sc: Obtained client Ka does not match corresponding test vector!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->Ke, g_md_value + (g_md_len / 2), (g_md_len / 2)), "sc: Obtained client Ke does not match corresponding test vector!");
}

static void get_and_check_result_of_KDF(t_test_vector *tv)
{

    //Calculating KDF functions on server and client
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_calculate_HKDF(
                                     (unsigned char *)spake2_instance->KcAKcB,
                                     &(spake2_instance->KcAKcB_len),
                                     spake2_instance,
                                     g_md_value,
                                     spake2_instance->Ke_len));
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_calculate_HKDF(
                                     (unsigned char *)spake2_client_inst->KcAKcB,
                                     &(spake2_client_inst->KcAKcB_len),
                                     spake2_client_inst,
                                     g_md_value,
                                     spake2_client_inst->Ke_len));
    TEST_ASSERT_MESSAGE((!(spake2_client_inst->KcAKcB_len & 1)), "sc: Obtained KcAKcB client length is odd!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->KcA_len, (spake2_client_inst->KcAKcB_len / 2), "sc: Obtained KcA client length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->KcB_len, (spake2_client_inst->KcAKcB_len / 2), "sc: Obtained KcB client length differ from expected!");
    TEST_ASSERT_MESSAGE((!(spake2_instance->KcAKcB_len & 1)), "sc: Obtained KcAKcB server length is odd!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->KcA_len, (spake2_instance->KcAKcB_len / 2), "sc: Obtained KcA server length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(tv->KcB_len, (spake2_instance->KcAKcB_len / 2), "sc: Obtained KcB server length differ from expected!");
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "KcB from server:\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, spake2plus_select_KcA_KcB(spake2_instance, 1), (spake2_instance->KcAKcB_len / 2));
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "KcA from server:\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, spake2plus_select_KcA_KcB(spake2_instance, 0), (spake2_instance->KcAKcB_len / 2));
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "KcA from client:\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, spake2plus_select_KcA_KcB(spake2_client_inst, 1), (spake2_instance->KcAKcB_len / 2));
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "KcB from client:\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, spake2plus_select_KcA_KcB(spake2_client_inst, 0), (spake2_instance->KcAKcB_len / 2));
    TEST_ASSERT_EQUAL_MESSAGE(0,
                              memcmp(tv->KcA, spake2plus_select_KcA_KcB(spake2_instance, 0), (spake2_instance->KcAKcB_len / 2)),
                              "sc: Obtained KcA on server does not match corresponding test vector!");
    TEST_ASSERT_EQUAL_MESSAGE(0,
                              memcmp(tv->KcB, spake2plus_select_KcA_KcB(spake2_instance, 1), (spake2_instance->KcAKcB_len / 2)),
                              "sc: Obtained KcB on server does not match corresponding test vector!");
    TEST_ASSERT_EQUAL_MESSAGE(0,
                              memcmp(tv->KcA, spake2plus_select_KcA_KcB(spake2_client_inst, 1), (spake2_client_inst->KcAKcB_len / 2)),
                              "sc: Obtained KcA on client does not match corresponding test vector!");
    TEST_ASSERT_EQUAL_MESSAGE(0,
                              memcmp(tv->KcB, spake2plus_select_KcA_KcB(spake2_client_inst, 0), (spake2_client_inst->KcAKcB_len / 2)),
                              "sc: Obtained KcB on client does not match corresponding test vector!");
}

void get_and_check_Fa_Fb(t_test_vector *tv)
{
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_own_Fa_or_Fb(g_Fa_or_Fb, &g_Fa_or_Fb_len, spake2_instance, g_ctx));
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_get_own_Fa_or_Fb(g_Fa_or_Fb_client, &g_Fa_or_Fb_client_len, spake2_client_inst, g_ctx));
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "Fb from server:\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, g_Fa_or_Fb, g_Fa_or_Fb_len);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "Fa from client:\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, g_Fa_or_Fb_client, g_Fa_or_Fb_client_len);
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_verify(spake2_client_inst, g_Fa_or_Fb, g_Fa_or_Fb_len));
    TEST_ASSERT(SPAKE2PLUS_OK == spake2plus_verify(spake2_instance, g_Fa_or_Fb_client, g_Fa_or_Fb_client_len));

    spake2_instance->MAC_func(
        g_mac_a,
        &g_mac_a_len,
        spake2plus_select_KcA_KcB(spake2_instance, 0),
        (spake2_instance->KcAKcB_len / 2),
        tv->TT,
        tv->TT_len,
        spake2_instance->evp_md);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(A) = MAC(KcA, TT):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, tv->MAC_A, tv->MAC_A_len);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(A) from server (key: spake2plus_select_KcA_KcB(spake2_instance,0),):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, g_mac_a, g_mac_a_len);
    TEST_ASSERT_EQUAL_MESSAGE(tv->MAC_A_len, g_mac_a_len, "sc: Obtained MAC(A) length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->MAC_A, g_mac_a, g_mac_a_len),"sc: Obtained MAC(A) does not match corresponding test vector!");

    spake2_instance->MAC_func(
        g_mac_a,
        &g_mac_a_len,
        spake2plus_select_KcA_KcB(spake2_instance, 1),
        (spake2_instance->KcAKcB_len / 2),
        tv->TT,
        tv->TT_len,
        spake2_instance->evp_md);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(B) = MAC(KcB, TT):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, tv->MAC_B, tv->MAC_B_len);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(B) from server (key: spake2plus_select_KcA_KcB(spake2_instance,1),):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, g_mac_a, g_mac_a_len);
    TEST_ASSERT_EQUAL_MESSAGE(tv->MAC_B_len, g_mac_a_len, "sc: Obtained MAC(B) length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->MAC_B, g_mac_a, g_mac_a_len),"sc: Obtained MAC(B) does not match corresponding test vector!");

    spake2_instance->MAC_func(
        g_mac_a,
        &g_mac_a_len,
        spake2plus_select_KcA_KcB(spake2_client_inst, 1),
        (spake2_client_inst->KcAKcB_len / 2),
        tv->TT,
        tv->TT_len,
        spake2_client_inst->evp_md);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(A) = MAC(KcA, TT):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, tv->MAC_A, tv->MAC_A_len);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(A) from client (key: spake2plus_select_KcA_KcB(spake2_client_inst,1),):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, g_mac_a, g_mac_a_len);
    TEST_ASSERT_EQUAL_MESSAGE(tv->MAC_A_len, g_mac_a_len, "sc: Obtained MAC(A) length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->MAC_A, g_mac_a, g_mac_a_len),"sc: Obtained MAC(A) does not match corresponding test vector!");

    spake2_instance->MAC_func(
        g_mac_a,
        &g_mac_a_len,
        spake2plus_select_KcA_KcB(spake2_client_inst, 0),
        (spake2_client_inst->KcAKcB_len / 2),
        tv->TT,
        tv->TT_len,
        spake2_client_inst->evp_md);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(B) = MAC(KcB, TT):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, tv->MAC_B, tv->MAC_B_len);
    spake2plus_printf_debug(COMMON_DEBUG, stdout, NULL, "MAC(B) from client (key: spake2plus_select_KcA_KcB(spake2_client_inst,0),):\n");
    spake2plus_print_array(COMMON_DEBUG, NULL, g_mac_a, g_mac_a_len);
    TEST_ASSERT_EQUAL_MESSAGE(tv->MAC_B_len, g_mac_a_len, "sc: Obtained MAC(B) length differ from expected!");
    TEST_ASSERT_EQUAL_MESSAGE(0, memcmp(tv->MAC_B, g_mac_a, g_mac_a_len),"sc: Obtained MAC(B) does not match corresponding test vector!");
}

static void cleanup(void)
{
    BN_CTX_CHECK_NULL_AND_FREE(g_ctx);
    BN_CHECK_NULL_AND_FREE(g_x);
    BN_CHECK_NULL_AND_FREE(g_y);
    EC_POINT_CHECK_NULL_AND_FREE(g_V);
    EC_POINT_CHECK_NULL_AND_FREE(g_Z);
    EC_POINT_CHECK_NULL_AND_FREE(g_test_vector_Z);
    EC_POINT_CHECK_NULL_AND_FREE(g_test_vector_V);
    OPENSSL_CHECK_NULL_AND_FREE(g_TT);
    OPENSSL_CHECK_NULL_AND_FREE(g_pA_or_pB);
    OPENSSL_CHECK_NULL_AND_FREE(g_pA_or_pB_client);
    spake2plus_free(spake2_client_inst);
    spake2_client_inst = NULL;
}

void test_vectors_cs(void)
{

    t_test_vector *test_vector = &g_test_vector_cs;
    default_setup(g_client_id_ptr, g_srv_id_ptr);

    default_init_with_test_vector(test_vector, g_client_id_ptr, g_srv_id_ptr);
    spake2plus_generate_keys_Z_V(g_Z, g_V, spake2_client_inst, g_ctx);

    //Only V on client (A) does not depend on the random values
    TEST_ASSERT_MESSAGE((0 == EC_POINT_cmp(spake2_client_inst->group, g_V, g_test_vector_V, g_ctx)),
                        "sc: Obtained point V does not match V from test vectors for client!");

    get_and_check_TT(test_vector);
    get_and_check_hash_of_TT(test_vector);
    get_and_check_result_of_KDF(test_vector);
    get_and_check_Fa_Fb(test_vector);

    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_instance, g_Fa_or_Fb_client, g_Fa_or_Fb_client_len), "Normal server verification failed!");
    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_client_inst, g_Fa_or_Fb, g_Fa_or_Fb_len), "Normal client verification failed!");

    cleanup();
}

void test_vectors_c0(void)
{

    t_test_vector *test_vector = &g_test_vector_c0;
    default_setup(g_client_id_ptr, g_empty_string);

    default_init_with_test_vector(test_vector, g_client_id_ptr, g_empty_string);
    spake2plus_generate_keys_Z_V(g_Z, g_V, spake2_client_inst, g_ctx);

    //Only V on client (A) does not depend on the random values
    TEST_ASSERT_MESSAGE((0 == EC_POINT_cmp(spake2_client_inst->group, g_V, g_test_vector_V, g_ctx)),
                        "sc: Obtained point V does not match V from test vectors for client!");

    get_and_check_TT(test_vector);
    get_and_check_hash_of_TT(test_vector);
    get_and_check_result_of_KDF(test_vector);
    get_and_check_Fa_Fb(test_vector);

    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_instance, g_Fa_or_Fb_client, g_Fa_or_Fb_client_len), "Normal server verification failed!");
    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_client_inst, g_Fa_or_Fb, g_Fa_or_Fb_len), "Normal client verification failed!");

    cleanup();
}
void test_vectors_0s(void)
{

    t_test_vector *test_vector = &g_test_vector_0s;
    default_setup(g_empty_string, g_srv_id_ptr);

    default_init_with_test_vector(test_vector, g_empty_string, g_srv_id_ptr);
    spake2plus_generate_keys_Z_V(g_Z, g_V, spake2_client_inst, g_ctx);

    //Only V on client (A) does not depend on the random values
    TEST_ASSERT_MESSAGE((0 == EC_POINT_cmp(spake2_client_inst->group, g_V, g_test_vector_V, g_ctx)),
                        "sc: Obtained point V does not match V from test vectors for client!");

    get_and_check_TT(test_vector);
    get_and_check_hash_of_TT(test_vector);
    get_and_check_result_of_KDF(test_vector);
    get_and_check_Fa_Fb(test_vector);

    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_instance, g_Fa_or_Fb_client, g_Fa_or_Fb_client_len), "Normal server verification failed!");
    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_client_inst, g_Fa_or_Fb, g_Fa_or_Fb_len), "Normal client verification failed!");

    cleanup();
}
void test_vectors_00(void)
{

    t_test_vector *test_vector = &g_test_vector_00;
    default_setup(g_empty_string, g_empty_string);

    default_init_with_test_vector(test_vector, g_empty_string, g_empty_string);
    spake2plus_generate_keys_Z_V(g_Z, g_V, spake2_client_inst, g_ctx);

    //Only V on client (A) does not depend on the random values
    TEST_ASSERT_MESSAGE((0 == EC_POINT_cmp(spake2_client_inst->group, g_V, g_test_vector_V, g_ctx)),
                        "sc: Obtained point V does not match V from test vectors for client!");

    get_and_check_TT(test_vector);
    get_and_check_hash_of_TT(test_vector);
    get_and_check_result_of_KDF(test_vector);
    get_and_check_Fa_Fb(test_vector);

    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_instance, g_Fa_or_Fb_client, g_Fa_or_Fb_client_len), "Normal server verification failed!");
    TEST_ASSERT_EQUAL_MESSAGE(SPAKE2PLUS_OK, spake2plus_verify(spake2_client_inst, g_Fa_or_Fb, g_Fa_or_Fb_len), "Normal client verification failed!");

    cleanup();
}
